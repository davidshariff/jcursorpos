/**
 * jCursorPos
 * 
 * https://github.com/davidshariff/jCursorPos
 *
 * Copyright (c) 2013 David Shariff
 * http://davidshariff.com/blog/
 *
 * Licensed under the MIT license.
 **/
(function(e,c,a,g){var f={onChange:function(){},className:"jCursorPos"},d={clone:'<pre class="'+f.className+" "+f.(function(e,t,n,r){"use strict";function o(t,n){this.$el=e(t);this.$clone={};this.$cursor={};this.options=e.extend({},i,n);this._defaults=i;this.init()}var i={onChange:function(){},className:"jCursorPos"},s={clone:'<pre class="'+i.className+" "+i.className+'-clone"></pre>',clone_cursor:'<span class="'+i.className+" "+i.className+'-cursor"></span>'};o.prototype={init:function(){var e=this;this.createPluginStyles();this.createClone();this.$el.bind("keyup keydown paste focus mouseup",function(){e.updateCursor();e.updateOrig();e.options.onChange.call(e.$el,e.$cursor)})},calcCursor:function(){var e,t;if(this.$el.width()!==this.$clone.width()||this.$el.height()!==this.$clone.height()){this.cloneStyles()}e=this.$el.offset();t=this.$clone.find("."+i.className+"-cursor").position();return{position:t,offset:{left:e.left+t.left-this.$el.scrollLeft(),top:e.top+t.top-this.$el.scrollTop()}}},cloneStyles:function(){var e=["font-family","font-size","font-weight","font-style","color","text-transform","text-decoration","letter-spacing","word-spacing","line-height","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","width","height","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","position","display","visibility","z-index","overflow-x","overflow-y","white-space","clip","float","clear","cursor","list-style-image","list-style-position","list-style-type","marker-offset"],t=this.$el.prop("tagName")==="TEXTAREA"?"break-word":"normal",n=this.$el.prop("tagName")==="TEXTAREA"?"pre-wrap":"nowrap";this.$clone.css(this.$el.css(e)).css({left:"-9999px",position:"absolute","word-wrap":t,"white-space":n});if(this.$el.get(0).scrollHeight>this.$el.innerHeight()){this.$clone.css("overflow-y","scroll")}if(this.$el.get(0).scrollWidth>this.$el.innerWidth()){this.$clone.css("overflow-x","scroll")}},createClone:function(){this.$clone=e(s.clone).appendTo(e("body"));this.cloneStyles()},createPluginStyles:function(){var t=e("."+i.className+"-styles");if(t.length===0){t=e('<style class="'+i.className+'-styles"></style>').prepend("."+i.className+" br { display: block; }").prepend("."+i.className+"-cursor { display: inline-block; padding: 0; border: 0; }").appendTo("head")}},getCaretPos:function(){var e=this.$el[0],t=0;if("selectionStart"in e){t=e.selectionStart}else if("selection"in n){e.focus();var r=e.createTextRange(),i=n.selection.createRange().duplicate(),s=i.getBookmark();r.moveToBookmark(s);while(r.moveStart("character",-1)!==0){t++}}return t},getText:function(){return this.$el[0].contentEditable==="true"?this.$el.html():this.$el.val()},updateCursor:function(){var e=this.getCaretPos(),t=this.getText(),n=t.substring(0,e).replace(/\n/g,"<br>"),r=t.substring(e).replace(/\n/g,"<br>");this.$clone.html(n+s.clone_cursor+r);this.$cursor=this.calcCursor()},updateOrig:function(){this.$el.attr({"data-jcursorpos-offset-left":this.$cursor.offset.left,"data-jcursorpos-offset-top":this.$cursor.offset.top,"data-jcursorpos-position-left":this.$cursor.position.left,"data-jcursorpos-position-top":this.$cursor.position.top})}};e.fn.jCursorPos=function(t){return this.each(function(){if(!e.data(this,"plugin_jCursorPos")){e.data(this,"plugin_jCursorPos",new o(this,t))}})}})(jQuery,window,document);
